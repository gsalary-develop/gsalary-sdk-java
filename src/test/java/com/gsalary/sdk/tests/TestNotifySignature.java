package com.gsalary.sdk.tests;

import com.gsalary.sdk.GSalaryConnectionConfig;
import com.gsalary.sdk.GSalarySignatureHelper;
import com.gsalary.sdk.secure.RSAAlgorithm;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.io.UnsupportedEncodingException;

class TestNotifySignature {
//    private final String privateKey = "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";
    private final String publickey = "MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAh5IZ326cBlnjyj1YeP87MJxT1fjFCJSe0j+FlE4luQ0PuR1X8eOnaTwf2qqFhNzexAL4wqnAnPhDsvFXustsIBf3kd0fHZsl4QxluPYyOzUGKXr03HtaZtMkox+qPIXnuXCRkhBNYlEcgBW1T/6H8I8aH5b5hwcVIy2MtCARcwLJshUi1/bvUD36I0Imz9uw2sEzwPuDnfUtuAEkfvsr62WvDBitqD8uYA002ChzZOv4MUDuOWIejNAfwQCBiOwm5YhMMdVn5dD/PojJsDgN5Qio0PP4yOVfbJIjlUPKXubGzCaltU27VCcFwqXLCHGj2GKV54sro8yY9udfUSq7lgaI45Vno7VtUdMOGE3Y3uKezVbpijSJYWbi8ZiCNHevK47F5J7r33Y1oo5/VT4BrQns+ntjxjxkBdY2aP6jk3Kbn/ZhPXzIMvQiwwNNcHyu3pZsgpu4wKCIq/6M4WZ4/9qZ94tkpeWYJAQNC9F6XAMrSh0icAsOWfRR8UiiLCA+o+d7mbfJxTYQ9LvQHJWa60atvyvg0WhYSXyQywwElA14NwMMK4RBKgHUHjL3EvjhGC8BOzo21eVqscAPSacDf+6Ce+bWNQiv8CW14y2unl4XbwdAwThqgzELXp3/VQny9fwdBmLtFXpgr+33gE7iMYSaq1WwoS+ko9kO1imCX2kCAwEAAQ==";


    @Test
    void valid() throws UnsupportedEncodingException {
        GSalarySignatureHelper helper = new GSalarySignatureHelper(new GSalaryConnectionConfig()
                .setAppid("cd205b92-b7b2-4400-bcee-b5b40578bd78")
                .setServerPublicKeyString(publickey));

        boolean verify = helper.verify("POST", "/v1/cards/balance_modifies", "{\"card_id\":\"2024092813120122986000177912\",\"amount\":100,\"type\":\"INCREASE\",\"request_id\":\"228a1b6c-7194-4187-b69f-472b76ae511b\"}",
                "algorithm=RSA2,time=1727592569369,signature=fsZ-LDsi39CYm2L0MOu8dCBUFVjjlPF0ix3abZjk93I4dYr0pntkN7hsNwbDC1CE2iEW3cefgGVbxklVl1evb78L2RlagLlXaOXGKYt_5RuxD1iaS4PdKYmPUub1dsjjXOSFI9ppX0pfWU86Ga6YMRlzX8AZI74HgCPS_oAYLD073nd_UPS-GEyOMK2ySd8KAhAYM0g9Se5uqFe2vGZFH4PreevMnhQmViV8vxGAc8vnZh-C9xKjkQAc1Ng5SjsyPa9DtBdb7AnxWkbcObV4OropvleVYUzzH4lHhV7cmq07Uk-omVsyEAfvZBCL0MHPZS5Ce6irN80VEWcrb9UcYu6SENX0XrA60ZSIUxiHojM7XRDt7mk_MeEGaWUm1MDNe0S1a9OkC6hJZcVHhY8G0QHLA7xUAvfR7zwPwF6Jo8qUq879aAwmRdZBTpRGWTmkqYrjq0UitUtJPtmydTQ2eQfItPeBfCQQDt2199OPTQA2nneLjG6heCI6a6l7lRctpF664Pp7ZLFK-tufhcPWlGVYmKyH-S_x4bxjejHEjWfiQhcB7_Z3kJsbsr9WHv3am7XjU8qdP737ZyCd-oUTZzL9Uttllh8skWRYtGfVLPfXnzxUMbQ9DdZjtWZ7If3X2o6_dfRL9RuD2Jyf5QnRc4YYSe9dJR2es3Z2S3YwcmY=", true);
        Assertions.assertTrue(verify);
    }

    @Test
    void testValid(){
        GSalaryConnectionConfig connConfig = new GSalaryConnectionConfig()
                .setAppid("cd205b92-b7b2-4400-bcee-b5b40578bd78")
                .setServerPublicKeyString(publickey);
        String signBase = "GET /v1/cards/balance_modifies/83bfc29a-cefa-4dde-8654-a8cd0f1ece65\ncd205b92-b7b2-4400-bcee-b5b40578bd78\n1727592569369\n\n";
        String sign = "EiTrUR1HpBk0rSrn0i-DnxnoyyJjrT4KuUg5wzy9kQBbmgf6wkcd7OUcCleeRlBc6sibAKxwywIobNmbgZtzXG1r3U0suT_rsvHe6gwXwF_ugE58scokSUx-Wesi5QJ_SnsvbGWVMhpYgkMGMWSb8ne4NH0do5Rdb9CVWM8oexH2-K39uqmsTsQTBSzhf8fi54Uu1J6NGxQywFYN5CJhpC78H59Vt5qGYhr2mK2LmfG2eW18y7OsczMwHfD6SoQMbI7OgDg3v21xC3TX--4u6NxOyGGkrxFgV8_ppCPhKB1dJTSZE067x7BYO6OeKPw-AXskBMZiwmOzscL2T4L2ABJevPIJ5hQvqqp4Gft3bIygiVeQfwWXdHdcXLqMtzGK0gTec2Y_sqp7KWXXjHCgfW67UrbLXHEWWipD0ir05nKeRYMePoHrclHlFGKw91IP1mZ_66CRN0m-vR-52eEK6M_kj5hbNWJt5uFc4bRVSdveyS43uv62J8R7c7zbmHKqBsGnXoioxWYFY3mF2apQob8zrut_wuvipIuI6oKMOyFNKW5uyBiOSVfXisAC_yuIF5HGPfiQNgYk2nc826N2NxCmuo8a78e0XRVdVXgk4iNSKKgXe4QRrqGTUYvXOz-hL_mEPzSmaog0OMmcRMfSBQgOjh4tnLup22E8ExQirQY=";
        boolean verify = RSAAlgorithm.verifySignature(connConfig.getServerPublicKey(), signBase, sign);
        Assertions.assertTrue(verify);
    }

}
